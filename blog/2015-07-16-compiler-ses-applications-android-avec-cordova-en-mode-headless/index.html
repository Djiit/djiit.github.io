<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="lang">
  <head>
    <title data-vue-tag="true">Compiler ses applications Android avec Cordova en mode headless - Julien Tanay</title><meta data-vue-tag="true" charset="utf-8"><meta data-vue-tag="true" name="generator" content="Gridsome v0.6.4"><meta data-vue-tag="true" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="true" data-key="description" name="description" content="About Software Development, DevOps culture, creative thinking and getting shit done."><meta data-vue-tag="true" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="true" name="keywords" content="Gridsome,Vue,Tailwind,Tailwind CSS,JavaScript,HTML,CSS,Vue.js,VueJS"><meta data-vue-tag="true" name="summary" content="Gridsome Portfolio Starter"><meta data-vue-tag="true" name="author" content="Andre Madarang"><link data-vue-tag="true" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.9bb7ffa.png"><link data-vue-tag="true" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.9bb7ffa.png"><link data-vue-tag="true" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.9bb7ffa.png"><link data-vue-tag="true" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.9bb7ffa.png"><link data-vue-tag="true" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.9bb7ffa.png"><link data-vue-tag="true" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.9bb7ffa.png"><link data-vue-tag="true" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.9bb7ffa.png"><link data-vue-tag="true" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.9bb7ffa.png"><link data-vue-tag="true" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito+Sans:400,700"><noscript data-vue-tag="true" ><style>.g-image--loading{display:none;}</style></noscript><link rel="preload" href="/assets/css/0.styles.6049e191.css" as="style"><link rel="preload" href="/assets/js/app.44b58109.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--post-vue.8faf8a94.js" as="script"><link rel="prefetch" href="/assets/js/page--src--pages--404-vue.9ec03e31.js"><link rel="prefetch" href="/assets/js/page--src--pages--blog-vue.1fecc93f.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.c60fb935.js"><link rel="prefetch" href="/assets/js/page--src--templates--tag-vue.5b1724c3.js"><link rel="stylesheet" href="/assets/css/0.styles.6049e191.css">
  </head>
  <body data-vue-tag="">
    <div data-server-rendered="true" id="app" class="content-wrapper bg-background-primary font-sans text-copy-primary leading-normal flex flex-col min-h-screen"><header class="border-t-14 border-blue-700"><nav class="container mx-auto flex flex-wrap justify-between items-center py-8"><div><a href="/" class="active">Julien Tanay</a></div><div class="block lg:hidden"><button class="flex items-center px-3 py-2 border rounded border-gray-500 hover:text-gray-600 hover:border-gray-600"><svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" class="current-color h-3 w-3"><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z" fill="gray"></path></svg></button></div><ul class="uppercase tracking-wide font-bold w-full block flex-grow lg:flex lg:flex-initial lg:w-auto items-center mt-8 lg:mt-0 hidden"><li class="mr-8 mb-6 lg:mb-0"><div class="relative" data-v-072e84ca><div data-v-3ae9f24e data-v-072e84ca></div><div class="relative w-80" data-v-072e84ca><input type="text" placeholder="Search (Press  "/" to focus)" value="" class="bg-background-form border border-gray-500 rounded-full px-4 pl-10 py-2 outline-none focus:border-blue-500 w-80" data-v-072e84ca><div class="absolute top-0 ml-3" style="top:10px" data-v-072e84ca><svg fill="currentColor" viewBox="0 0 24 24" width="24" height="24" class="text-gray-500 h-5 w-5" data-v-072e84ca><path d="M16.32 14.9l5.39 5.4a1 1 0 0 1-1.42 1.4l-5.38-5.38a8 8 0 1 1 1.41-1.41zM10 16a6 6 0 1 0 0-12 6 6 0 0 0 0 12z" class="heroicon-ui" data-v-072e84ca></path></svg></div><!----></div><!----></div></li><li class="mr-8 mb-6 lg:mb-0"><a href="#" class="text-copy-primary hover:text-gray-600"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"></circle><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path></svg></a></li><li class="mr-8 mb-6 lg:mb-0"><a href="/#about" class="text-copy-primary hover:text-gray-600">About</a></li><li class="mr-8 mb-6 lg:mb-0"><a href="/#projects" class="text-copy-primary hover:text-gray-600">Projects</a></li><li class="mr-8 mb-6 lg:mb-0"><a href="/#contact" class="text-copy-primary hover:text-gray-600">Contact</a></li><li><a href="/blog" class="text-copy-primary hover:text-gray-600 active">Blog</a></li></ul></nav></header><div class="flex-grow"><div class="container-inner mx-auto my-16"><h1 class="text-4xl font-bold leading-tight">Compiler ses applications Android avec Cordova en mode headless</h1><div class="text-xl text-gray-600 mb-4">July 16, 2015</div><div class="flex mb-8 text-sm"><a href="/blog/tag/Int%C3%A9gration%20Continue" class="bg-gray-300 rounded-full px-4 py-2 mr-4 hover:bg-blue-300">
        Intégration Continue
      </a><a href="/blog/tag/Android" class="bg-gray-300 rounded-full px-4 py-2 mr-4 hover:bg-blue-300">
        Android
      </a><a href="/blog/tag/SDK" class="bg-gray-300 rounded-full px-4 py-2 mr-4 hover:bg-blue-300">
        SDK
      </a><a href="/blog/tag/Cordova" class="bg-gray-300 rounded-full px-4 py-2 mr-4 hover:bg-blue-300">
        Cordova
      </a><a href="/blog/tag/Jenkins" class="bg-gray-300 rounded-full px-4 py-2 mr-4 hover:bg-blue-300">
        Jenkins
      </a><a href="/blog/tag/headless" class="bg-gray-300 rounded-full px-4 py-2 mr-4 hover:bg-blue-300">
        headless
      </a></div><div class="markdown-body mb-8"><p>On trouve ça et là des tutoriaux pour installer le SDK Android et compiler ses applications avec Cordova.</p>
<p>La plupart se contentent d’enchaîner les captures d'écrans en mode cliquodrome... Lorsqu'il s'agit d'équiper une machine sans interface graphique, idéalement pour en faire une machine de build, c'est tout de suite plus obscur. Vous êtes derrière un proxy ? Accrochez-vous.
Retour d'expérience sur l'installation du SDK Android sur une Debian 64bits fraîchement installée.</p>
<h2 id="rapatrier-les-dépendances"><a href="#rapatrier-les-d%C3%A9pendances" aria-hidden="true"><span class="icon icon-link"></span></a>Rapatrier les dépendances</h2>
<p>Installer <code>wget</code> (si besoin), <code>java7</code> et <code>zipalign</code> qui nous servira à signer nos APK.</p>
<pre class="shiki" style="background-color: #292D3E"><code><span style="color: #FFFFFF">apt-get install wget zipalign openjdk-7-jdk ant</span></code></pre>
<p>Sur une distribution 64bits récente, il vous faudra installer les dépendances suivantes :</p>
<p>Pour Ubuntu :</p>
<pre class="shiki" style="background-color: #292D3E"><code><span style="color: #FFFFFF">apt-get install libc6-i386 libglib2.0-0:i386 libsm6:i386 libglu1-mesa:i386 libgl1-mesa-glx:i386 libxext6:i386 libxrender1:i386 libx11-6:i386 libfontconfig1:i386 lsb-core</span></code></pre>
<p>Pour Debian (testé sur Wheezy) :</p>
<pre class="shiki" style="background-color: #292D3E"><code><span style="color: #FFFFFF">dpkg --add-architecture i386</span>
<span style="color: #FFFFFF">apt-get update</span>
<span style="color: #FFFFFF">apt-get install libncurses5:i386 libstdc++6:i386 zlib1g:i386</span></code></pre>
<h2 id="android-sdk-tool"><a href="#android-sdk-tool" aria-hidden="true"><span class="icon icon-link"></span></a>Android SDK Tool</h2>
<p>Sortez un terminal et récupérez la dernière version du SDK Tool (voir <a href="https://developer.android.com/sdk/index.html#Other" target="_blank" rel="nofollow noopener noreferrer">https://developer.android.com/sdk/index.html#Other</a>) :</p>
<pre class="shiki" style="background-color: #292D3E"><code><span style="color: #82AAFF">cd</span><span style="color: #FFFFFF"> /tmp</span>
<span style="color: #FFFFFF">wget http://dl.google.com/android/android-sdk_r24.3.3-linux.tgz</span>
<span style="color: #FFFFFF">tar -xzf android-sdk_r24.3.3-linux.tgz</span>
<span style="color: #FFFFFF">rm android-sdk_r24.3.3-linux.tgz</span>
<span style="color: #FFFFFF">mv android-sdk-linux /opt/</span></code></pre>
<p>On a au passage extrait tout le dossier dans <code>/opt</code> histoire d'y accéder facilement plus tard.</p>
<p>(Optionnel) Indiquer un proxy HTTP dans le fichier <code>~/.android/androidtool.cfg</code> (pensez à remplacer les variables par de vraies valeurs) :</p>
<pre class="shiki" style="background-color: #292D3E"><code><span style="color: #82AAFF">echo</span><span style="color: #FFFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">sdkman.force.http=true</span>
<span style="color: #C3E88D">http.proxyHost=&lt;proxy_host&gt;</span>
<span style="color: #C3E88D">http.proxyPort=&lt;proxy_port&gt;</span><span style="color: #89DDFF">"</span><span style="color: #FFFFFF"> </span><span style="color: #C792EA">&gt;</span><span style="color: #FFFFFF"> </span><span style="color: #C792EA">~</span><span style="color: #FFFFFF">/.android/androidtool.cfg</span></code></pre>
<p>Une fois android-sdk-tools installé, rendez-le accessible dans votre PATH:</p>
<pre class="shiki" style="background-color: #292D3E"><code><span style="color: #C792EA">export</span><span style="color: #FFFFFF"> ANDROID_HOME=/opt/android-sdk-linux</span>
<span style="color: #C792EA">export</span><span style="color: #FFFFFF"> PATH=</span><span style="color: #89DDFF">${</span><span style="color: #A6ACCD">PATH</span><span style="color: #89DDFF">}</span><span style="color: #FFFFFF">:</span><span style="color: #89DDFF">$</span><span style="color: #A6ACCD">ANDROID_HOME</span><span style="color: #FFFFFF">/tools:</span><span style="color: #89DDFF">$</span><span style="color: #A6ACCD">ANDROID_HOME</span><span style="color: #FFFFFF">/platform-tools</span></code></pre>
<p>On récupère les dernières versions du SDK :</p>
<pre class="shiki" style="background-color: #292D3E"><code><span style="color: #FFFFFF">android update sdk --no-ui</span></code></pre>
<p>(Optionnel) Installer une version des build-tools particulière :</p>
<pre class="shiki" style="background-color: #292D3E"><code><span style="color: #FFFFFF">android update sdk --all --filter </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">build-tools-22.0.1</span><span style="color: #89DDFF">"</span><span style="color: #FFFFFF"> --no-ui</span></code></pre>
<p>That's it ! La machine est prête à enchaîner les builds. Essayez donc de créer un projet :</p>
<pre class="shiki" style="background-color: #292D3E"><code><span style="color: #FFFFFF">android create project \</span>
<span style="color: #FFFFFF">--target 1 \</span>
<span style="color: #FFFFFF">--name MyAndroidApp \</span>
<span style="color: #FFFFFF">--path ./MyAndroidAppProject \</span>
<span style="color: #FFFFFF">--activity MyAndroidAppActivity \</span>
<span style="color: #FFFFFF">--package com.example.myandroidapp</span></code></pre>
<p>On peut facilement ranger tout ça dans un script d'installation à soumettre à SaltSack ou Puppet. Reste à déclarer la machine, par exemple, en tant que slave Jenkins dédié à des jobs de compilation Android.</p>
<h2 id="cordova"><a href="#cordova" aria-hidden="true"><span class="icon icon-link"></span></a>Cordova</h2>
<p>Assurez-vous d'avoir la dernière version de NodeJS / NPM avant de passer à l'installation de Cordova (<a href="https://nodesource.com/blog/nodejs-v012-iojs-and-the-nodesource-linux-repositories" target="_blank" rel="nofollow noopener noreferrer">https://nodesource.com/blog/nodejs-v012-iojs-and-the-nodesource-linux-repositories</a>). C'est parti :</p>
<pre class="shiki" style="background-color: #292D3E"><code><span style="color: #FFFFFF">npm install -g cordova</span></code></pre>
<p>Note : Cordova utilise Gradle pour build les projets; le coup du proxy peut-être assez casse-tête.</p>
<p>(Optionnel) Indiquer un proxy HTTP et HTTPS dans le fichier <code>~/.gradle/gradle.properties</code> (pensez à remplacer les variables par de vraies valeurs) :</p>
<code class="shiki" style="background: #2e3440; color: #d8dee9">echo &quot; systemProp.http.proxyHost=&lt;proxy_host&gt;
systemProp.http.proxyPort=&lt;proxy_port&gt;
systemProp.http.proxyUser=&lt;proxy_user&gt;
systemProp.http.proxyPassword=&lt;proxy_password&gt;
systemProp.https.proxyHost=&lt;proxy_host&gt;
systemProp.https.proxyPort=&lt;proxy_port&gt;
systemProp.https.proxyUser=&lt;proxy_user&gt;
systemProp.https.proxyPassword=&lt;proxy_password&gt; &quot; &gt; ~/.gradle/gradle.properties</code>
<p>Placez-vous dans votre dossier de projet Cordova (ou créez-en un avec <code>cordova create MonProjet</code>). Le petit bout de code suivant assure le build complet d'un APK signé. Il utilise 3 variables d'environnement pour récupérer l'emplacement de votre keystore (<code>ANDROID_KEYSTORE</code>), le mot de passe associé (<code>ANDROID_STORE_PASS</code>) et la keypass spécifique à votre application (<code>ANDROID_KEY_PASS</code>). L’avantage direct de ces variables est de ne pas avoir à stocker dans le projet (et donc souvent dans un dépôt de versionning) des informations sensibles comme les passwords ou encore le fichier <code>.keystore</code>. En plus, rien de plus facile pour Jenkins ou un autre outil d'intégration continue de passer ces variables avant le lancement d'un job de compilation.</p>
<pre class="shiki" style="background-color: #292D3E"><code><span style="color: #FFFFFF">cordova platforms add android</span>
<span style="color: #FFFFFF">cordova build android --release</span>
<span style="color: #FFFFFF">jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore </span><span style="color: #89DDFF">$(</span><span style="color: #C3E88D">ANDROID_KEYSTORE</span><span style="color: #89DDFF">)</span><span style="color: #FFFFFF"> -storepass </span><span style="color: #89DDFF">$(</span><span style="color: #C3E88D">ANDROID_STORE_PASS</span><span style="color: #89DDFF">)</span><span style="color: #FFFFFF"> platforms/android/build/outputs/apk/android-release-unsigned.apk BatStat -keypass </span><span style="color: #89DDFF">$(</span><span style="color: #C3E88D">ANDROID_KEY_PASS</span><span style="color: #89DDFF">)</span>
<span style="color: #FFFFFF">zipalign -f -v 4 platforms/android/build/outputs/apk/android-release-unsigned.apk platforms/android/build/outputs/apk/android-release-signed.apk</span></code></pre>
<p>Vous pouvez à loisir mettre ça dans une target <code>android</code> d'un fichier <code>Makefile</code> et lancer un joli <code>make android</code> pour compiler vos applis ! Joie !</p>
<p>N'hésitez pas à laisser vos commentaires juste là-dessous.</p>
<h2 id="quelques-liens"><a href="#quelques-liens" aria-hidden="true"><span class="icon icon-link"></span></a>Quelques liens</h2>
<ul>
<li><a href="https://developer.android.com/sdk/index.html" target="_blank" rel="nofollow noopener noreferrer">https://developer.android.com/sdk/index.html</a></li>
<li><a href="https://developer.android.com/tools/projects/projects-cmdline.html" target="_blank" rel="nofollow noopener noreferrer">https://developer.android.com/tools/projects/projects-cmdline.html</a></li>
<li><a href="http://doc.ubuntu-fr.org/android_sdk" target="_blank" rel="nofollow noopener noreferrer">http://doc.ubuntu-fr.org/android_sdk</a></li>
<li><a href="https://cordova.apache.org/" target="_blank" rel="nofollow noopener noreferrer">https://cordova.apache.org/</a></li>
</ul>
</div><div id="disqus_thread"></div><div class="mb-8"><a href="/blog" class="font-bold uppercase active">Back to Blog</a></div></div></div><footer class="bg-blue-700 text-white"><div class="container mx-auto flex flex-col lg:flex-row items-center justify-between py-8"><div class="mb-8 lg:mb-0"><div>Copyright 2019. All rights reserved.</div><div><a href="rss.xml" class="text-white hover:text-gray-400 font-normal">RSS Feed</a>
          |
          <a href="sitemap.xml" class="text-white hover:text-gray-400 font-normal">Sitemap</a></div></div><ul class="flex items-center"><li class="mr-8"><a href="mailto:julien.tanay@gmail.com" class="text-white hover:text-gray-400"><svg width="25" height="20" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 0h20A2.5 2.5 0 0 1 25 2.5v15a2.5 2.5 0 0 1-2.5 2.5h-20A2.5 2.5 0 0 1 0 17.5v-15C0 1.125 1.125 0 2.5 0zm20 4.225V2.5h-20v1.725l10 5 10-5zm0 2.8l-9.438 4.713a1.25 1.25 0 0 1-1.124 0L2.5 7.025V17.5h20V7.025z" fill-rule="nonzero"></path></svg></a></li><li class="mr-8"><a href="https://github.com/djiit" target="_blank" class="text-white hover:text-gray-400"><svg width="20" height="19" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M10 0c1.814 0 3.487.435 5.02 1.306a9.827 9.827 0 0 1 3.639 3.542A9.33 9.33 0 0 1 20 9.734c0 2.121-.636 4.03-1.908 5.723a9.783 9.783 0 0 1-4.928 3.518c-.234.042-.408.012-.52-.09a.49.49 0 0 1-.17-.38l.006-.969c.005-.621.007-1.19.007-1.705 0-.82-.226-1.42-.677-1.8.495-.05.94-.126 1.335-.228a5.4 5.4 0 0 0 1.223-.494 3.62 3.62 0 0 0 1.055-.843c.282-.334.512-.777.69-1.33.178-.554.267-1.19.267-1.909a3.7 3.7 0 0 0-1.028-2.61c.32-.77.286-1.631-.105-2.586-.243-.076-.594-.03-1.054.14-.46.168-.86.354-1.198.557l-.495.304a9.478 9.478 0 0 0-2.5-.33c-.86 0-1.693.11-2.5.33a11.6 11.6 0 0 0-.553-.342c-.23-.135-.593-.298-1.088-.488-.494-.19-.863-.247-1.106-.171-.391.955-.426 1.816-.105 2.585A3.7 3.7 0 0 0 3.62 9.227c0 .719.089 1.352.267 1.902.178.549.406.993.683 1.33.278.339.627.622 1.048.85a5.4 5.4 0 0 0 1.224.494c.395.102.84.178 1.335.228-.338.305-.551.74-.638 1.306a2.631 2.631 0 0 1-.586.19 3.782 3.782 0 0 1-.742.063c-.287 0-.57-.09-.853-.272a2.256 2.256 0 0 1-.723-.792 2.068 2.068 0 0 0-.631-.66c-.256-.168-.471-.27-.645-.304l-.26-.038c-.182 0-.308.02-.378.057-.07.038-.09.087-.065.146.026.06.065.118.117.178.053.059.109.11.17.152l.09.063c.192.085.38.245.567.482.187.236.324.452.41.646l.13.292c.113.32.304.58.574.78.269.198.56.325.872.38.312.054.614.084.905.088.29.004.532-.01.723-.044l.299-.05c0 .32.002.694.007 1.12l.006.692a.49.49 0 0 1-.17.38c-.112.101-.286.13-.52.089a9.783 9.783 0 0 1-4.928-3.518C.636 13.763 0 11.855 0 9.734a9.33 9.33 0 0 1 1.341-4.886 9.827 9.827 0 0 1 3.64-3.542C6.512.436 8.185 0 10 0zM3.79 13.98c.025-.058-.005-.11-.092-.151-.087-.026-.143-.017-.17.025-.025.06.005.11.092.152.078.05.134.042.17-.025zm.403.432c.06-.043.052-.11-.026-.203-.087-.076-.157-.089-.209-.038-.06.042-.052.11.026.203.087.084.157.097.209.038zm.39.57c.078-.06.078-.14 0-.24-.07-.11-.143-.136-.221-.077-.078.042-.078.118 0 .228.078.11.152.14.221.089zm.547.532c.07-.067.052-.148-.052-.24-.104-.102-.19-.115-.26-.039-.078.068-.061.148.052.241.104.102.19.114.26.038zm.742.317c.026-.093-.03-.16-.169-.203-.13-.033-.213-.004-.247.09-.035.092.021.155.169.19.13.05.213.025.247-.077zm.82.064c0-.11-.073-.157-.22-.14-.14 0-.209.047-.209.14 0 .11.074.156.221.139.14 0 .209-.046.209-.14zm.756-.127c-.017-.093-.096-.131-.234-.114-.14.025-.2.088-.183.19.018.101.096.135.235.101.139-.034.2-.093.182-.177z" fill-rule="nonzero"></path></svg></a></li><li class="mr-8"><a href="https://twitter.com/djiit" target="_blank" class="text-white hover:text-gray-400"><svg width="20" height="17" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M19.807 1.943a8.588 8.588 0 0 1-2.036 2.135 11.918 11.918 0 0 1-.465 3.854 12.085 12.085 0 0 1-1.452 3.177 12.426 12.426 0 0 1-2.318 2.691c-.897.78-1.978 1.402-3.243 1.867-1.265.464-2.618.697-4.06.697-2.27 0-4.348-.618-6.233-1.854.293.034.62.051.98.051 1.885 0 3.565-.588 5.04-1.764a3.915 3.915 0 0 1-2.363-.825 4.038 4.038 0 0 1-1.432-2.039c.276.043.532.064.766.064.36 0 .717-.047 1.068-.14A3.982 3.982 0 0 1 1.73 8.43c-.617-.754-.925-1.63-.925-2.627v-.051c.57.324 1.182.498 1.835.524a4.1 4.1 0 0 1-1.32-1.47 4.078 4.078 0 0 1-.49-1.969c0-.75.185-1.445.553-2.084a11.548 11.548 0 0 0 3.702 3.05 11.163 11.163 0 0 0 4.669 1.271c-.067-.324-.1-.639-.1-.946 0-1.142.395-2.116 1.187-2.92C11.632.402 12.589 0 13.712 0c1.173 0 2.161.435 2.966 1.304a7.878 7.878 0 0 0 2.576-.997 3.997 3.997 0 0 1-1.785 2.275 7.98 7.98 0 0 0 2.338-.639z" fill-rule="nonzero"></path></svg></a></li></ul></div></footer></div>
    <script>window.__INITIAL_STATE__={"data":{"post":{"title":"Compiler ses applications Android avec Cordova en mode headless","date":"July 16, 2015","content":"\u003Cp\u003EOn trouve ça et là des tutoriaux pour installer le SDK Android et compiler ses applications avec Cordova.\u003C\u002Fp\u003E\n\u003Cp\u003ELa plupart se contentent d’enchaîner les captures d'écrans en mode cliquodrome... Lorsqu'il s'agit d'équiper une machine sans interface graphique, idéalement pour en faire une machine de build, c'est tout de suite plus obscur. Vous êtes derrière un proxy ? Accrochez-vous.\nRetour d'expérience sur l'installation du SDK Android sur une Debian 64bits fraîchement installée.\u003C\u002Fp\u003E\n\u003Ch2 id=\"rapatrier-les-dépendances\"\u003E\u003Ca href=\"#rapatrier-les-d%C3%A9pendances\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003ERapatrier les dépendances\u003C\u002Fh2\u003E\n\u003Cp\u003EInstaller \u003Ccode\u003Ewget\u003C\u002Fcode\u003E (si besoin), \u003Ccode\u003Ejava7\u003C\u002Fcode\u003E et \u003Ccode\u003Ezipalign\u003C\u002Fcode\u003E qui nous servira à signer nos APK.\u003C\u002Fp\u003E\n\u003Cpre class=\"shiki\" style=\"background-color: #292D3E\"\u003E\u003Ccode\u003E\u003Cspan style=\"color: #FFFFFF\"\u003Eapt-get install wget zipalign openjdk-7-jdk ant\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003ESur une distribution 64bits récente, il vous faudra installer les dépendances suivantes :\u003C\u002Fp\u003E\n\u003Cp\u003EPour Ubuntu :\u003C\u002Fp\u003E\n\u003Cpre class=\"shiki\" style=\"background-color: #292D3E\"\u003E\u003Ccode\u003E\u003Cspan style=\"color: #FFFFFF\"\u003Eapt-get install libc6-i386 libglib2.0-0:i386 libsm6:i386 libglu1-mesa:i386 libgl1-mesa-glx:i386 libxext6:i386 libxrender1:i386 libx11-6:i386 libfontconfig1:i386 lsb-core\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EPour Debian (testé sur Wheezy) :\u003C\u002Fp\u003E\n\u003Cpre class=\"shiki\" style=\"background-color: #292D3E\"\u003E\u003Ccode\u003E\u003Cspan style=\"color: #FFFFFF\"\u003Edpkg --add-architecture i386\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #FFFFFF\"\u003Eapt-get update\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #FFFFFF\"\u003Eapt-get install libncurses5:i386 libstdc++6:i386 zlib1g:i386\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch2 id=\"android-sdk-tool\"\u003E\u003Ca href=\"#android-sdk-tool\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EAndroid SDK Tool\u003C\u002Fh2\u003E\n\u003Cp\u003ESortez un terminal et récupérez la dernière version du SDK Tool (voir \u003Ca href=\"https:\u002F\u002Fdeveloper.android.com\u002Fsdk\u002Findex.html#Other\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Ehttps:\u002F\u002Fdeveloper.android.com\u002Fsdk\u002Findex.html#Other\u003C\u002Fa\u003E) :\u003C\u002Fp\u003E\n\u003Cpre class=\"shiki\" style=\"background-color: #292D3E\"\u003E\u003Ccode\u003E\u003Cspan style=\"color: #82AAFF\"\u003Ecd\u003C\u002Fspan\u003E\u003Cspan style=\"color: #FFFFFF\"\u003E \u002Ftmp\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #FFFFFF\"\u003Ewget http:\u002F\u002Fdl.google.com\u002Fandroid\u002Fandroid-sdk_r24.3.3-linux.tgz\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #FFFFFF\"\u003Etar -xzf android-sdk_r24.3.3-linux.tgz\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #FFFFFF\"\u003Erm android-sdk_r24.3.3-linux.tgz\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #FFFFFF\"\u003Emv android-sdk-linux \u002Fopt\u002F\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EOn a au passage extrait tout le dossier dans \u003Ccode\u003E\u002Fopt\u003C\u002Fcode\u003E histoire d'y accéder facilement plus tard.\u003C\u002Fp\u003E\n\u003Cp\u003E(Optionnel) Indiquer un proxy HTTP dans le fichier \u003Ccode\u003E~\u002F.android\u002Fandroidtool.cfg\u003C\u002Fcode\u003E (pensez à remplacer les variables par de vraies valeurs) :\u003C\u002Fp\u003E\n\u003Cpre class=\"shiki\" style=\"background-color: #292D3E\"\u003E\u003Ccode\u003E\u003Cspan style=\"color: #82AAFF\"\u003Eecho\u003C\u002Fspan\u003E\u003Cspan style=\"color: #FFFFFF\"\u003E \u003C\u002Fspan\u003E\u003Cspan style=\"color: #89DDFF\"\u003E\"\u003C\u002Fspan\u003E\u003Cspan style=\"color: #C3E88D\"\u003Esdkman.force.http=true\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #C3E88D\"\u003Ehttp.proxyHost=&lt;proxy_host&gt;\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #C3E88D\"\u003Ehttp.proxyPort=&lt;proxy_port&gt;\u003C\u002Fspan\u003E\u003Cspan style=\"color: #89DDFF\"\u003E\"\u003C\u002Fspan\u003E\u003Cspan style=\"color: #FFFFFF\"\u003E \u003C\u002Fspan\u003E\u003Cspan style=\"color: #C792EA\"\u003E&gt;\u003C\u002Fspan\u003E\u003Cspan style=\"color: #FFFFFF\"\u003E \u003C\u002Fspan\u003E\u003Cspan style=\"color: #C792EA\"\u003E~\u003C\u002Fspan\u003E\u003Cspan style=\"color: #FFFFFF\"\u003E\u002F.android\u002Fandroidtool.cfg\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EUne fois android-sdk-tools installé, rendez-le accessible dans votre PATH:\u003C\u002Fp\u003E\n\u003Cpre class=\"shiki\" style=\"background-color: #292D3E\"\u003E\u003Ccode\u003E\u003Cspan style=\"color: #C792EA\"\u003Eexport\u003C\u002Fspan\u003E\u003Cspan style=\"color: #FFFFFF\"\u003E ANDROID_HOME=\u002Fopt\u002Fandroid-sdk-linux\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #C792EA\"\u003Eexport\u003C\u002Fspan\u003E\u003Cspan style=\"color: #FFFFFF\"\u003E PATH=\u003C\u002Fspan\u003E\u003Cspan style=\"color: #89DDFF\"\u003E${\u003C\u002Fspan\u003E\u003Cspan style=\"color: #A6ACCD\"\u003EPATH\u003C\u002Fspan\u003E\u003Cspan style=\"color: #89DDFF\"\u003E}\u003C\u002Fspan\u003E\u003Cspan style=\"color: #FFFFFF\"\u003E:\u003C\u002Fspan\u003E\u003Cspan style=\"color: #89DDFF\"\u003E$\u003C\u002Fspan\u003E\u003Cspan style=\"color: #A6ACCD\"\u003EANDROID_HOME\u003C\u002Fspan\u003E\u003Cspan style=\"color: #FFFFFF\"\u003E\u002Ftools:\u003C\u002Fspan\u003E\u003Cspan style=\"color: #89DDFF\"\u003E$\u003C\u002Fspan\u003E\u003Cspan style=\"color: #A6ACCD\"\u003EANDROID_HOME\u003C\u002Fspan\u003E\u003Cspan style=\"color: #FFFFFF\"\u003E\u002Fplatform-tools\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EOn récupère les dernières versions du SDK :\u003C\u002Fp\u003E\n\u003Cpre class=\"shiki\" style=\"background-color: #292D3E\"\u003E\u003Ccode\u003E\u003Cspan style=\"color: #FFFFFF\"\u003Eandroid update sdk --no-ui\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E(Optionnel) Installer une version des build-tools particulière :\u003C\u002Fp\u003E\n\u003Cpre class=\"shiki\" style=\"background-color: #292D3E\"\u003E\u003Ccode\u003E\u003Cspan style=\"color: #FFFFFF\"\u003Eandroid update sdk --all --filter \u003C\u002Fspan\u003E\u003Cspan style=\"color: #89DDFF\"\u003E\"\u003C\u002Fspan\u003E\u003Cspan style=\"color: #C3E88D\"\u003Ebuild-tools-22.0.1\u003C\u002Fspan\u003E\u003Cspan style=\"color: #89DDFF\"\u003E\"\u003C\u002Fspan\u003E\u003Cspan style=\"color: #FFFFFF\"\u003E --no-ui\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EThat's it ! La machine est prête à enchaîner les builds. Essayez donc de créer un projet :\u003C\u002Fp\u003E\n\u003Cpre class=\"shiki\" style=\"background-color: #292D3E\"\u003E\u003Ccode\u003E\u003Cspan style=\"color: #FFFFFF\"\u003Eandroid create project \\\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #FFFFFF\"\u003E--target 1 \\\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #FFFFFF\"\u003E--name MyAndroidApp \\\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #FFFFFF\"\u003E--path .\u002FMyAndroidAppProject \\\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #FFFFFF\"\u003E--activity MyAndroidAppActivity \\\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #FFFFFF\"\u003E--package com.example.myandroidapp\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EOn peut facilement ranger tout ça dans un script d'installation à soumettre à SaltSack ou Puppet. Reste à déclarer la machine, par exemple, en tant que slave Jenkins dédié à des jobs de compilation Android.\u003C\u002Fp\u003E\n\u003Ch2 id=\"cordova\"\u003E\u003Ca href=\"#cordova\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003ECordova\u003C\u002Fh2\u003E\n\u003Cp\u003EAssurez-vous d'avoir la dernière version de NodeJS \u002F NPM avant de passer à l'installation de Cordova (\u003Ca href=\"https:\u002F\u002Fnodesource.com\u002Fblog\u002Fnodejs-v012-iojs-and-the-nodesource-linux-repositories\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Ehttps:\u002F\u002Fnodesource.com\u002Fblog\u002Fnodejs-v012-iojs-and-the-nodesource-linux-repositories\u003C\u002Fa\u003E). C'est parti :\u003C\u002Fp\u003E\n\u003Cpre class=\"shiki\" style=\"background-color: #292D3E\"\u003E\u003Ccode\u003E\u003Cspan style=\"color: #FFFFFF\"\u003Enpm install -g cordova\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003ENote : Cordova utilise Gradle pour build les projets; le coup du proxy peut-être assez casse-tête.\u003C\u002Fp\u003E\n\u003Cp\u003E(Optionnel) Indiquer un proxy HTTP et HTTPS dans le fichier \u003Ccode\u003E~\u002F.gradle\u002Fgradle.properties\u003C\u002Fcode\u003E (pensez à remplacer les variables par de vraies valeurs) :\u003C\u002Fp\u003E\n\u003Ccode class=\"shiki\" style=\"background: #2e3440; color: #d8dee9\"\u003Eecho &quot; systemProp.http.proxyHost=&lt;proxy_host&gt;\nsystemProp.http.proxyPort=&lt;proxy_port&gt;\nsystemProp.http.proxyUser=&lt;proxy_user&gt;\nsystemProp.http.proxyPassword=&lt;proxy_password&gt;\nsystemProp.https.proxyHost=&lt;proxy_host&gt;\nsystemProp.https.proxyPort=&lt;proxy_port&gt;\nsystemProp.https.proxyUser=&lt;proxy_user&gt;\nsystemProp.https.proxyPassword=&lt;proxy_password&gt; &quot; &gt; ~\u002F.gradle\u002Fgradle.properties\u003C\u002Fcode\u003E\n\u003Cp\u003EPlacez-vous dans votre dossier de projet Cordova (ou créez-en un avec \u003Ccode\u003Ecordova create MonProjet\u003C\u002Fcode\u003E). Le petit bout de code suivant assure le build complet d'un APK signé. Il utilise 3 variables d'environnement pour récupérer l'emplacement de votre keystore (\u003Ccode\u003EANDROID_KEYSTORE\u003C\u002Fcode\u003E), le mot de passe associé (\u003Ccode\u003EANDROID_STORE_PASS\u003C\u002Fcode\u003E) et la keypass spécifique à votre application (\u003Ccode\u003EANDROID_KEY_PASS\u003C\u002Fcode\u003E). L’avantage direct de ces variables est de ne pas avoir à stocker dans le projet (et donc souvent dans un dépôt de versionning) des informations sensibles comme les passwords ou encore le fichier \u003Ccode\u003E.keystore\u003C\u002Fcode\u003E. En plus, rien de plus facile pour Jenkins ou un autre outil d'intégration continue de passer ces variables avant le lancement d'un job de compilation.\u003C\u002Fp\u003E\n\u003Cpre class=\"shiki\" style=\"background-color: #292D3E\"\u003E\u003Ccode\u003E\u003Cspan style=\"color: #FFFFFF\"\u003Ecordova platforms add android\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #FFFFFF\"\u003Ecordova build android --release\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #FFFFFF\"\u003Ejarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore \u003C\u002Fspan\u003E\u003Cspan style=\"color: #89DDFF\"\u003E$(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #C3E88D\"\u003EANDROID_KEYSTORE\u003C\u002Fspan\u003E\u003Cspan style=\"color: #89DDFF\"\u003E)\u003C\u002Fspan\u003E\u003Cspan style=\"color: #FFFFFF\"\u003E -storepass \u003C\u002Fspan\u003E\u003Cspan style=\"color: #89DDFF\"\u003E$(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #C3E88D\"\u003EANDROID_STORE_PASS\u003C\u002Fspan\u003E\u003Cspan style=\"color: #89DDFF\"\u003E)\u003C\u002Fspan\u003E\u003Cspan style=\"color: #FFFFFF\"\u003E platforms\u002Fandroid\u002Fbuild\u002Foutputs\u002Fapk\u002Fandroid-release-unsigned.apk BatStat -keypass \u003C\u002Fspan\u003E\u003Cspan style=\"color: #89DDFF\"\u003E$(\u003C\u002Fspan\u003E\u003Cspan style=\"color: #C3E88D\"\u003EANDROID_KEY_PASS\u003C\u002Fspan\u003E\u003Cspan style=\"color: #89DDFF\"\u003E)\u003C\u002Fspan\u003E\n\u003Cspan style=\"color: #FFFFFF\"\u003Ezipalign -f -v 4 platforms\u002Fandroid\u002Fbuild\u002Foutputs\u002Fapk\u002Fandroid-release-unsigned.apk platforms\u002Fandroid\u002Fbuild\u002Foutputs\u002Fapk\u002Fandroid-release-signed.apk\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003EVous pouvez à loisir mettre ça dans une target \u003Ccode\u003Eandroid\u003C\u002Fcode\u003E d'un fichier \u003Ccode\u003EMakefile\u003C\u002Fcode\u003E et lancer un joli \u003Ccode\u003Emake android\u003C\u002Fcode\u003E pour compiler vos applis ! Joie !\u003C\u002Fp\u003E\n\u003Cp\u003EN'hésitez pas à laisser vos commentaires juste là-dessous.\u003C\u002Fp\u003E\n\u003Ch2 id=\"quelques-liens\"\u003E\u003Ca href=\"#quelques-liens\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EQuelques liens\u003C\u002Fh2\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fdeveloper.android.com\u002Fsdk\u002Findex.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Ehttps:\u002F\u002Fdeveloper.android.com\u002Fsdk\u002Findex.html\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fdeveloper.android.com\u002Ftools\u002Fprojects\u002Fprojects-cmdline.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Ehttps:\u002F\u002Fdeveloper.android.com\u002Ftools\u002Fprojects\u002Fprojects-cmdline.html\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"http:\u002F\u002Fdoc.ubuntu-fr.org\u002Fandroid_sdk\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Ehttp:\u002F\u002Fdoc.ubuntu-fr.org\u002Fandroid_sdk\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ca href=\"https:\u002F\u002Fcordova.apache.org\u002F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Ehttps:\u002F\u002Fcordova.apache.org\u002F\u003C\u002Fa\u003E\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n","tags":[{"title":"Intégration Continue","path":"\u002Fblog\u002Ftag\u002FInt%C3%A9gration%20Continue"},{"title":"Android","path":"\u002Fblog\u002Ftag\u002FAndroid"},{"title":"SDK","path":"\u002Fblog\u002Ftag\u002FSDK"},{"title":"Cordova","path":"\u002Fblog\u002Ftag\u002FCordova"},{"title":"Jenkins","path":"\u002Fblog\u002Ftag\u002FJenkins"},{"title":"headless","path":"\u002Fblog\u002Ftag\u002Fheadless"}]}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.44b58109.js" defer></script><script src="/assets/js/page--src--templates--post-vue.8faf8a94.js" defer></script>
  </body>
</html>
