{"data":{"post":{"title":"Utiliser Docker derriere un proxy sur CoreOS","date":"July 5, 2015","content":"<p>Petit tips du jour qui pourra sauver l'après midi de certains...</p>\n<h2 id=\"the-place-beyond-the-proxy\"><a href=\"#the-place-beyond-the-proxy\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>The Place beyond the Proxy</h2>\n<p>Certains utilisateurs de Docker sont bien cachés derrière un proxy d'entreprise ou autre méchanceté du genre. Docker permet d'utiliser notamment les variables d'environnement <code>http_proxy</code> et <code>https_proxy</code> (capacité directement hérité des librairies Go).</p>\n<p>Sous CoreOS, on peut aussi renseigner une bonne fois pour toutes les informations de connexion au proxy dans un fichier de configuration et... ne plus y penser. Joie!</p>\n<h2 id=\"lets-do-this-\"><a href=\"#lets-do-this-\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Let's do this !</h2>\n<p>Commencons par créer ou éditer la configuration du <em>unit</em> Docker de systemd :</p>\n<p>\\$ sudo vim /etc/systemd/system/docker.service.d/http-proxy.conf</p>\n<p>On y rentre les variables d'environnement qui nous intéressent</p>\n<code class=\"shiki\" style=\"background: #2e3440; color: #d8dee9\">[Service]\nEnvironment=&quot;HTTP_PROXY=http://[user]:[password]@[hostname]:[port]&quot; &quot;NO_PROXY=localhost,127.0.0.0/8,172.17.0.0/16,.sock&quot;</code>\n<p>Le \".sock\" vous évitera quelques maux de cranes (le client Docker sera ainsi capable de contacter le démon via le socket Unix).</p>\n<p>On demande à systemd de prendre en compte nos modificatrions sur l'Unit Docker :</p>\n<code class=\"shiki\" style=\"background: #2e3440; color: #d8dee9\">$ sudo systemctl daemon-reload</code>\n<p>On redémarre ensuite le service Docker :</p>\n<code class=\"shiki\" style=\"background: #2e3440; color: #d8dee9\">$ sudo systemctl restart docker</code>\n<p>That's it, un petit test rapide : <code>docker pull busybox</code> vous confirmera que Docker peut bien récupérer les images à travers votre proxy !</p>\n","tags":[{"title":"Docker","path":"/blog/tag/Docker"},{"title":"CoreOS","path":"/blog/tag/CoreOS"},{"title":"proxy","path":"/blog/tag/proxy"},{"title":"DevOps","path":"/blog/tag/DevOps"}]}},"context":{}}