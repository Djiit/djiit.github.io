<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="lang">
  <head>
    <title data-vue-tag="true">Docker pour les développeurs: Environment as Code - Julien Tanay</title><meta data-vue-tag="true" charset="utf-8"/><meta data-vue-tag="true" name="generator" content="Gridsome v0.5.4"/><meta data-vue-tag="true" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/><meta data-vue-tag="true" data-key="description" name="description" content="About Software Development, DevOps culture, creative thinking and hacking things."/><meta data-vue-tag="true" data-key="format-detection" name="format-detection" content="telephone=no"/><meta data-vue-tag="true" name="description" content="Envie d&#x27;exporter ses belles playlists en dehors de Whyd ? Introducing &quot;WhydToGo&quot;."/><link data-vue-tag="true" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.9bb7ffa.png"/><link data-vue-tag="true" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.9bb7ffa.png"/><link data-vue-tag="true" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.9bb7ffa.png"/><link data-vue-tag="true" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.9bb7ffa.png"/><link data-vue-tag="true" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.9bb7ffa.png"/><link data-vue-tag="true" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.9bb7ffa.png"/><link data-vue-tag="true" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.9bb7ffa.png"/><link data-vue-tag="true" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.9bb7ffa.png"/><noscript data-vue-tag="true" ><style>.g-image--loading{display:none;}</style></noscript><link rel="preload" href="/assets/css/styles.994dae9e.css" as="style"><link rel="preload" href="/assets/js/app.971b028e.js" as="script"><link rel="preload" href="/assets/css/3.styles.399fc422.css" as="style"><link rel="preload" href="/assets/js/component--post.3bb65112.js" as="script"><link rel="prefetch" href="/assets/js/component--404.b1620c5f.js"><link rel="prefetch" href="/assets/js/component--home.31d8346b.js"><link rel="prefetch" href="/assets/js/component--tag.e0385307.js"><link rel="prefetch" href="/assets/js/page-query.1fa13168.js"><link rel="stylesheet" href="/assets/css/styles.994dae9e.css"><link rel="stylesheet" href="/assets/css/3.styles.399fc422.css">
  </head>
  <body data-vue-tag="">
    <script>
      // Add dark / light detection that runs before Vue.js load. Borrowed from overreacted.io
      (function() {
        window.__onThemeChange = function() {};
        function setTheme(newTheme) {
          window.__theme = newTheme;
          preferredTheme = newTheme;
          document.body.setAttribute('data-theme', newTheme);
          window.__onThemeChange(newTheme);
        }

        var preferredTheme;
        try {
          preferredTheme = localStorage.getItem('theme');
        } catch (err) { }

        window.__setPreferredTheme = function(newTheme) {
          setTheme(newTheme);
          try {
            localStorage.setItem('theme', newTheme);
          } catch (err) {}
        }

        var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');
        darkQuery.addListener(function(e) {
          window.__setPreferredTheme(e.matches ? 'dark' : 'light')
        });

        setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
      })();
    </script>

    <div id="app" data-server-rendered="true"><header class="header"><div class="header__left"><a href="/" class="logo active"><span class="logo__text">
    ← Julien Tanay
  </span></a></div><div class="header__right"><button role="button" aria-label="Toggle dark/light" class="toggle-theme"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></button></div></header><main class="main"><div class="post-title"><h1 class="post-title__text">
      Docker pour les développeurs: Environment as Code
    </h1><div class="post-meta">
   Posted 2. August 2015.
   <strong>4 min read.</strong></div></div><div class="post content-box"><div class="post__header"><!----></div><div class="post__content"><p>Docker, ce game changer qu'un certain Solomon Hykes venait (bien trop) rapidement presenter en pleine PyCon UK 2013 (<a href="https://www.youtube.com/watch?v=wW9CAH9nSLs" target="_blank" rel="nofollow noopener noreferrer">souvenirs</a>) change radicalement la vie des (dev)ops. Mais pour un dev' tout court, quelle utilité ?
Spoiler Alert : Docker (et Docker-Compose) va permettre de déclarer de manière simple et portable un ensemble de services tiers liés à notre application. Chaque dev peut alors mettre en route en quelques instants un environnement de développement <em>iso</em> à celui du reste de son équipe. Ou du reste du monde. Portabilité bonjour.</p>
<h2 id="compose-toi-toi-même"><a href="#compose-toi-toi-m%C3%AAme" aria-hidden="true"><span class="icon icon-link"></span></a>Compose toi toi-même</h2>
<p><a href="https://docs.docker.com/compose/" target="_blank" rel="nofollow noopener noreferrer">Docker-Compose</a>, anciennement Fig créé par <a href="https://www.orchardup.com/" target="_blank" rel="nofollow noopener noreferrer">Orchard</a> (racheté par Docker Inc. depuis) est un outil qui permet de facilement déclarer dans un fichier YaML les différents services qui lient notre applications. On y décrit comment les conteneurs qui accueillent les services dont notre application a besoin sont liés entre eux et doivent se comporter (ports à exposer, volumes à monter, etc...) comme on le ferait en ligne de commande avec le client <code class="language-text">docker</code>. Exemple ici pour un wiki simpliste :</p>
<pre class="language-yaml"><span class="token key atrule">Mediawiki</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">"nickstenning/mediawiki:latest"</span>
  <span class="token key atrule">links</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">"MySQL:mysql"</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">"8088:80"</span>
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">"/var/mediawiki:/data"</span>
<span class="token key atrule">MySQL</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">"centurylink/mysql:5.5"</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">"3306:3306"</span>
  <span class="token key atrule">expose</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">"3306"</span>
  <span class="token key atrule">environment</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> MYSQL_ROOT_PASSWORD=MediaWiki.123</pre>
<p>NOTE: Note: Cet exemple est honteusement pompé sur <a href="https://lorry.io/" target="_blank" rel="nofollow noopener noreferrer">Lorry.io</a> (voir lien en fin d'article). En plus des services dont dépend notre projet, on peut déclarer des services de monitoring, un stack ELK portable, des services de mocks, etc... Ultra-pratique.</p>
<p>On sort le CLI docker-compose (<code class="language-text">pip install docker-compose</code>) et on commence à orchestrer tout ce petit monde :</p>
<pre class="language-bash">docker-compose start ./docker-compose.yml</pre>
<p>Le fichier est alors passé au démon Docker qui va se charger de récupérer ou build les images selon les cas et démarrer les conteneurs demandés avec un nom parlant. Voilà, votre environnement de dev est prêt!</p>
<h2 id="ce-nest-que-du-texte"><a href="#ce-nest-que-du-texte" aria-hidden="true"><span class="icon icon-link"></span></a>Ce n'est que du texte</h2>
<p>...Et le texte, ça se versionne très simplement ! Comme ce bon vieux <code class="language-text">requirements.txt</code> bien connus des Pythonistes qui permet déjà de récupérer les dépendances d'un projet, on applique le même traitement à notre environnement. En ajoutant le fichier <code class="language-text">docker-compose.yml</code> à un dépôt de versionning git par exemple, on permet à n'importe qui de rapidement cloner le dépôt et monter un environnement de développement. Plus besoin d'installer tout un tas de paquets sur sa machine ni de monter une VM dédiée.</p>
<p>En bonus, on peut joindre au dépôt un <code class="language-text">Dockerfile</code> et ajouter notre projet dans le <code class="language-text">docker-compose.yml</code> pour qu'une instance soit lancée en même temps que le reste de l'environnement : <em>Docker-ception</em>.</p>
<h2 id="docker-est-development-ready"><a href="#docker-est-development-ready" aria-hidden="true"><span class="icon icon-link"></span></a>Docker est "Development-Ready"</h2>
<p>Cela change radicalement des worklows de développement où l'on passait un temps fou à trouver une machine propice au développement d'un projet en particulier, où l'on installait en dur sur sa machine un moteur de base de données, un serveur web, etc...</p>
<p>Même avec l'avènement de solutions comme Vagrant, on avait toujours besoin d'avoir un moteur de machines virtuelles (VirtualBox, VMWare, etc...). Docker nous facilite grandement la vie et gère toute la complexité de partager un environnement de dev de bout en bout.</p>
<p>En production, la donne est légèrement différente (car les problématiques ne sont pas les mêmes). Mais les solutions compatibles avec ce workflow de développement existent ! Tous les grands <em>cloud providers</em> proposent déjà un service de <em>hosting</em> de conteneurs; et chacun applique sa propre sauce d'orchestration des services. <a href="https://giantswarm.io/" target="_blank" rel="nofollow noopener noreferrer">GiantSwarm</a>, un <em>cloud provider</em> proposant une offre de PaaS pensée pour gérer des conteneurs possède son propre vocabulaire de description des services : c'est un dernier fichier YAML à joindre à son code et "pouf" votre application est déployée en poussant votre code - "Heroku-style", mais on parle ici de <em>tous</em> les composants (ou micro-services) de votre application, même les services tiers comme la BDD, etc...).</p>
<p>NOTE: Note: GiantSwarm est actuellement en phase d'early access. J'ai la chance de pouvoir tester leurs services et je vous assure que le mot déploiement revêt un sens nouveau depuis que je teste leur plate-forme. Allez y faire un tour.</p>
<p>Enfin, <a href="http://rancher.com/rancher-feature-iii/" target="_blank" rel="nofollow noopener noreferrer">Rancher</a>, un moteur de PaaS à installer soi-même comme un grand à choisi d'utiliser la grammaire de docker-compose (on peut donc lui donner à manger un <code class="language-text">docker-compose.yml</code> et il se charger de monter nos services !) et de l'étendre avec un <code class="language-text">rancher-compose.yml</code> qui permet de définir des règles d'auto-scale, de load-balancing et plus encore.</p>
<p>L’approche de Rancher, pendant que j’y suis, est assez originale : votre outil d'orchestration est lui aussi rangé dans un conteneur. Il est multi-environnement, possède une bel interface web et l’équipe à l’origine du projet propose également <em>RancherOS</em>, un OS ou quasiment <em>tout</em> est conteneurisé. Je pourrais vous en parler des heures, mais vous êtes déjà parti vous monter un cluster <em>CoreOS</em> pour tester tout ça, je le sais bien.</p>
<p>Et vous ? Docker en environnement de dev ? de prod ?!</p>
<h2 id="quelques-liens"><a href="#quelques-liens" aria-hidden="true"><span class="icon icon-link"></span></a>Quelques liens</h2>
<ul>
<li>Docker-Compose: <a href="https://docs.docker.com/compose/" target="_blank" rel="nofollow noopener noreferrer">https://docs.docker.com/compose/</a></li>
<li>Giant-Swarm : <a href="https://giantswarm.io/" target="_blank" rel="nofollow noopener noreferrer">https://giantswarm.io/</a></li>
<li>Rancher / Rancher OS : <a href="http://rancher.com/" target="_blank" rel="nofollow noopener noreferrer">http://rancher.com/</a></li>
<li>Lorry.io : <a href="https://lorry.io/" target="_blank" rel="nofollow noopener noreferrer">https://lorry.io/</a></li>
</ul>
</div><div class="post__footer"><div class="post-tags"><a href="/blog/tag/docker" class="post-tags__link"><span>#</span> Docker
		</a><a href="/blog/tag/docker-compose" class="post-tags__link"><span>#</span> Docker-Compose
		</a><a href="/blog/tag/dev-ops" class="post-tags__link"><span>#</span> DevOps
		</a><a href="/blog/tag/giant-swarm" class="post-tags__link"><span>#</span> GiantSwarm
		</a><a href="/blog/tag/rancher" class="post-tags__link"><span>#</span> Rancher
		</a></div></div></div><div class="post-comments"></div><div class="author post-author"><img alt="Author image" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 180 180' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-13'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='5'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-13)' width='180' height='180' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCABAAEADASIAAhEBAxEB/8QAGwAAAgMBAQEAAAAAAAAAAAAABgcEBQgCAwH/xAAyEAABAwIFAgQFAgcAAAAAAAABAgMEBREABhIhMRNBByJRYRQycYGRI7EIFjNyosHw/8QAGQEAAgMBAAAAAAAAAAAAAAAABAUAAgMB/8QAKhEAAQQABQIFBQEAAAAAAAAAAQACAxEEEiExQSJRBROBkaFhcbHh8MH/2gAMAwEAAhEDEQA/AMqY%2b98fMdtIU46hCfmUQkffEURVSMvQn4DL06UtrWA4rQLnTc7D3wYUSsUujlqPRIKGkDzqlOHW8r032Axe0nLMWr1CLR2kKWQ1pbWkWCEoFiSRxv373wRnwVDVPdWkSlyEnULCw04RS4hsxLX3Xbj4TyLDhgBAFoKzbmukZkhNMRoYMptJKnFAWWb/APb4V9SpZbdOhOgqOySoEH6YbNY8OlxktuxSUnm3II9/fAfWMsVPWolTbixxcW2xrhJIYumN2n1VMRA54twQ3R6izSolViy6UxKelNdJDjw80dW41J2O%2b/txisZjqcIAF74v3Irklm7qAmWwsMvN6eRbyqPv2/GGD4RZPg1mvxUTnEtNKNla%2bMET4pmHY6QpfDgwHucOd9%2bBX9SS6UlSrAEn0GJLCEtPNrd3CVAlKTcnvbEpSFLN0sOaVKJPTT9%2bRiXTYfxMtiM3Hd6rzqWkak2F1GwufTBbpKCq2KytS%2bBsFkpqVRCCtxelANr6RzYYbcoyFMABwtpO23OMeZ0y/m6msSZMJ9xESBITFSYDy7vEt6ysWsdICe%2b/PvjqmtVWrZbTUMt5wri6jZCREfmKB6qUEuNjfcmxWi22lJ1EKsCthwmdpLXbo6XFBj6c1aTrWXy6SI%2bh5CxqUm4SQSeR%2beMLqvU5uOtTLybKB%2b4wl6TmPxFeok%2btQ6tVnIEVaEvPqUVp1bEC5vvwcS8pVzM2aXn0fzDFalNKSpTciPqUprfW4NKSVaTp8ouo6rgEA2zPhhLraQtR4g0DqB1VnXoaIlZdW0Bpkxil0ab3KVJKT7H3xDps56MW1Mkt2vxiqhVGst5zap%2bY0oaU04WpJ0A6Uk7kKTcEbCxFx6YN24lBcdQlqptrUFKGlAJJNuLWwPigYSGSC9ONV2N7Zbcw0rhb0SixoUanuQ5B%2bCEjppuQiw%2bUqB542O%2bIlLz6uyDIpcRSbjzJWRbcfnFtVaEIlSIpojpQSQoIbHH2HGPeLl6c8hYbj08FKdYQWkXI9RcXwFiIYR1SAX3uuT%2bvZaBr4%2bkusjnQfhMGGxFep05uPNE34l5E1uUEjZRBCTY3BAA0kdwSMDdSo9Oef6QyflyXL%2bS5haLH%2b1N/3GPPJIdgVF2LLDKOqglGhICbp5G31wV13M7tMqLEDLsVL0x79V9ex3Pa52Fhvvxg%2bDzZKERrn0GvJC3ZGJTWWz7fdUr87LEPw6qWXorgcWoKafKGShJetupN%2bQDYC1xZIHbCgi5ZjMqRUBC6M8KKjIiS1sqC%2b6hb5b78Yt85w5khx%2bS%2b06ib1OoHo0lDgT33R3xVUisuOwnIssWltH5kgjqJPG3Y3wSHnJmaTmv0r3u7%2bF18MLW04a%2bhCNfC6k0xLlRm16PNk06NHait2Zcl6OmdQBXbZKU7AbAA2HGDlyiZQrtCqE7L8IM/DoUoSGkqZKVadW3FwR7WwYUfJU%2bmZMRBplckQkuRipxpUZtf6i03XckXvc/bCeosCfFiPJFeqCWXWQVsEIKT5LaeL%2b2FvjuB6GysdT9Nbd9OAa%2bEshlEjiG6AKylTJyH0KCGEKWFIWPKLgFPYfvia05/UdqK1al%2bc3BFz9bYuqJ4c1apPsSK8Y8NKdV0JeLqzf6WA/JwdMZUpMXppeY662hsp0k/TbjFnQSSRnNdhXdO3NolJm2iSGvD5FYhEplxH1ygbG62jYEfSwvhbZXzehNYfnVVSiy4DrQFbkcAD2xqSrpS60WSkFChpII2IxkzOWR%2bnV5yaY6thLbiwlpwbWv2PpgrDxDyjnGgqz2v9oqOOR7C9g2XpmBykOvyqjBfdjqSrUUKWCkj27468GKXPzr4mxW0JD1PhEPynEWFm0q2G/qqw/OAN3LNUKunJdbQjudWrb2GNEfwwx00Ck1pcH4JTrrzba3JTxQo2STtZJ282GLPIAaBv3/tuyHxT5CwU3LW%2bu5/xaOu4qOoOIsog3sRjOdcp9IiZejS136tkkyUsgr43Ukc3Ha%2bHO5mGYkLu5RwRwOu4b/4YEqpUHpDam1RsqlJFrLjrV/rC/xcNmaynVlN/f5QmEzMcTW6/9k=' /%3e%3c/svg%3e" width="180" data-src="/assets/static/author.e6b6009.1ecea5f.jpg" data-srcset="/assets/static/author.e6b6009.1ecea5f.jpg 180w" data-sizes="(max-width: 180px) 100vw, 180px" class="author__image g-image g-image--lazy g-image--loading"><noscript><img src="/assets/static/author.e6b6009.1ecea5f.jpg" class="author__image g-image g-image--loaded" width="180"></noscript><!----><p class="author__intro">
    About Software Development, DevOps culture, creative thinking and hacking things.
  </p><p class="author__links"><a href="//twitter.com/djiit">Follow on Twitter</a><a href="//github.com/djiit">GitHub</a></p></div></main><footer class="footer"><span class="footer__copyright">Copyright © 2015 - 2019.
    </span><span class="footer__links">Powered by <a href="//gridsome.org"> Gridsome </a></span></footer></div>
    <script src="/assets/js/app.971b028e.js" defer></script><script src="/assets/js/component--post.3bb65112.js" defer></script>
  </body>
</html>