{"data":{"post":{"title":"Pipfile and Pipenv : the future of Python dependencies management","date":"November 7, 2017","content":"<p>Yes, I heared you. pip <em>is</em> a great tool and has been around for quite a long time. But for 3 years or so, people (contributors) have been looking for a way to enhance our packages management experience. Think about the superpowers of <em>composer</em>, <em>npm</em> (or better, <em>yarn</em>) in your favorite tool.</p>\n<p>What they offer is (more or less) a replacement for the age-old requirements.txt file : the <strong>Pipfile</strong>.</p>\n<h2 id=\"how-i-learn-to-stop-worrying-and-love-pip-again\"><a href=\"#how-i-learn-to-stop-worrying-and-love-pip-again\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>How I learn to stop worrying and love pip (again)</h2>\n<p>The new <a href=\"https://github.com/pypa/pipfile\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Pipfile</a> differs from the old-style requirements file in several ways :</p>\n<ul>\n<li>It uses <em>TOML</em> syntax to allow more configuration;</li>\n<li>It declares dependencies groups (i.e. a default one plus a development one for... development packages) so you don't have to split your requirements into several files.</li>\n<li>It comes with a Pipfile.lock file which pins the versions of your packages, in addition to some security bonus.</li>\n</ul>\n<p>Letâ€™s have a look at a minimal, simple Pipfile:</p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span style=\"color: #FFFFFF\">    [[source]]</span>\n<span style=\"color: #FFFFFF\">    </span><span style=\"color: #F78C6C\">url</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">https://pypi.python.org/simple</span><span style=\"color: #89DDFF\">'</span>\n<span style=\"color: #FFFFFF\">    </span><span style=\"color: #F78C6C\">verify_ssl</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #FFFFFF\"> true</span>\n<span style=\"color: #FFFFFF\">    </span><span style=\"color: #F78C6C\">name</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">pypi</span><span style=\"color: #89DDFF\">'</span>\n\n<span style=\"color: #FFFFFF\">    [requires]</span>\n<span style=\"color: #FFFFFF\">    </span><span style=\"color: #F78C6C\">python_version</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">3.6</span><span style=\"color: #89DDFF\">'</span>\n\n<span style=\"color: #FFFFFF\">    [packages]</span>\n<span style=\"color: #FFFFFF\">    </span><span style=\"color: #F78C6C\">flask</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">*</span><span style=\"color: #89DDFF\">'</span>\n\n<span style=\"color: #FFFFFF\">    [dev-packages]</span>\n<span style=\"color: #FFFFFF\">    </span><span style=\"color: #F78C6C\">pytest</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">*</span><span style=\"color: #89DDFF\">'</span></code></pre>\n<p>What do we have here :</p>\n<ul>\n<li>First we declare the source that pip is going to use. Typically, it will be <em>pypi</em>.</li>\n<li>Then we declare our Python version requirement.</li>\n<li>Finally, we declare our packages and development packages.</li>\n</ul>\n<p>You got it ? Now here is the example Pipfile from the official repository on GitHub :</p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span style=\"color: #89DDFF\">[</span><span style=\"color: #FFCB6B\">[source</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #FFFFFF\">]</span>\n<span style=\"color: #F78C6C\">url</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">https://pypi.python.org/simple</span><span style=\"color: #89DDFF\">'</span>\n<span style=\"color: #F78C6C\">verify_ssl</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #FFFFFF\"> true</span>\n<span style=\"color: #F78C6C\">name</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">pypi</span><span style=\"color: #89DDFF\">'</span>\n\n<span style=\"color: #89DDFF\">[</span><span style=\"color: #FFCB6B\">requires</span><span style=\"color: #89DDFF\">]</span>\n<span style=\"color: #F78C6C\">python_version</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">2.7</span><span style=\"color: #89DDFF\">'</span>\n\n<span style=\"color: #89DDFF\">[</span><span style=\"color: #FFCB6B\">packages</span><span style=\"color: #89DDFF\">]</span>\n<span style=\"color: #F78C6C\">requests</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #FFFFFF\"> { </span><span style=\"color: #F78C6C\">extras</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #FFFFFF\"> [</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">socks</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #FFFFFF\">] }</span>\n<span style=\"color: #F78C6C\">records</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">&gt;0.5.0</span><span style=\"color: #89DDFF\">'</span>\n<span style=\"color: #F78C6C\">django</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #FFFFFF\"> { </span><span style=\"color: #F78C6C\">git</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">https://github.com/django/django.git</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #FFFFFF\">, </span><span style=\"color: #F78C6C\">ref</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">1.11.4</span><span style=\"color: #89DDFF\">'</span><span style=\"color: #FFFFFF\">, </span><span style=\"color: #F78C6C\">editable</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #FFFFFF\"> true }</span>\n<span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">e682b37</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #FFFFFF\"> = {</span><span style=\"color: #F78C6C\">file</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">https://github.com/divio/django-cms/archive/release/3.4.x.zip</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #FFFFFF\">}</span>\n<span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">e1839a8</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #FFFFFF\"> = {</span><span style=\"color: #F78C6C\">path</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">.</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #FFFFFF\">, </span><span style=\"color: #F78C6C\">editable</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #FFFFFF\"> true}</span>\n<span style=\"color: #F78C6C\">pywinusb</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #FFFFFF\"> { </span><span style=\"color: #F78C6C\">version</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">*</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #FFFFFF\">, </span><span style=\"color: #F78C6C\">os_name</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">=='nt'</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #FFFFFF\">, </span><span style=\"color: #F78C6C\">index</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">pypi</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #FFFFFF\">}</span>\n\n<span style=\"color: #89DDFF\">[</span><span style=\"color: #FFCB6B\">dev-packages</span><span style=\"color: #89DDFF\">]</span>\n<span style=\"color: #F78C6C\">nose</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">'</span><span style=\"color: #C3E88D\">*</span><span style=\"color: #89DDFF\">'</span>\n<span style=\"color: #F78C6C\">unittest2</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #FFFFFF\"> {</span><span style=\"color: #F78C6C\">version</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">=</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">&gt;=1.0,&lt;3.0</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #FFFFFF\">, </span><span style=\"color: #F78C6C\">markers</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #C3E88D\">python_version &lt; '2.7.9' or (python_version &gt;= '3.0' and python_version &lt; '3.4')</span><span style=\"color: #89DDFF\">\"</span><span style=\"color: #FFFFFF\">}</span></code></pre>\n<p>See ? With the TOML syntax, you can be very specific about the version, source or os-variant you want to use. Note that all packages versions are not pinned, even if it <em>was</em> <a href=\"http://nvie.com/posts/pin-your-packages/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">the preferred way of declaring dependencies</a>.</p>\n<p>Pip is going to support this specification in the future with a syntax like pip install -p Pipfile. Let's see how we can use all this magical stuff today.</p>\n<h2 id=\"back-to-the-future\"><a href=\"#back-to-the-future\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Back to the Future</h2>\n<p>Meet <a href=\"https://docs.pipenv.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Pipenv</a> (yep, thatâ€™s another project from <a href=\"https://twitter.com/kennethreitz\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Kenneth Reitz</a>, the guy behind <a href=\"http://httpbin.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">httpbin</a>, <a href=\"https://gist.github.com/pep8.org\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">pep8.org</a>, and, yes, <a href=\"http://docs.python-requests.org/en/master/#\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">request</a>).</p>\n<blockquote class=\"twitter-tweet tw-align-center\"><p lang=\"en\" dir=\"ltr\">the fuck when you realize <a href=\"https://twitter.com/kennethreitz?ref_src=twsrc%5Etfw\">@kennethreitz</a> &#39;s pipenv just dropped a ðŸŽƒ in your shell. Made my day.</p>&mdash; Julien Tanay (@Djiit) <a href=\"https://twitter.com/Djiit/status/925350303863656448?ref_src=twsrc%5Etfw\">October 31, 2017</a></blockquote>\n<p>Pipenv is the current preferred implementation of Pipfile and allows you to manage your virtualenvs like a boss. It aims to ease and enhance how we manage our python environments (a la <em>virtualenvwrapper</em> or <em>pyenv</em>, but with <em>pip</em> skills).</p>\n<p>Here is a simple workflow :</p>\n<p>1- In your project directory, create your <em>virtualenv</em>. Pipenv will store it in a centralized place instead of your project root directory :</p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span style=\"color: #FFFFFF\">pipenv --three </span><span style=\"color: #676E95\"># Yeah, 3 is the way to go</span></code></pre>\n<p>2- Install some dependencies :</p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span style=\"color: #FFFFFF\">pipenv install flask</span>\n<span style=\"color: #FFFFFF\">pipenv install --dev pytest </span><span style=\"color: #676E95\"># Notice the --dev flag</span></code></pre>\n<p>3- Use your <em>virtualenv</em>. It will open a new shell :</p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span style=\"color: #FFFFFF\">pipenv shell</span></code></pre>\n<p>Note that we were not <em>in</em> our virtualenv before this command. Everything is handled for us by <em>Pipenv</em>.</p>\n<p>From this point, you are good to go. Pipenv will help you manage your environment throughout your development process.</p>\n<p>Finally, you shouldnâ€™t be worried about compatibility issues with your deployment server (which is surely still using <em>pip</em> as you are reading this) : you can generate a good old requirements.txt by running :</p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span style=\"color: #FFFFFF\">pipenv lock -r </span><span style=\"color: #C792EA\">&gt;</span><span style=\"color: #FFFFFF\"> requirements.txt</span></code></pre>\n<p>Pipenv handles saving your dependencies and it even adds some security reinforcements by specifying each packageâ€™s hash.</p>\n<p>Thatâ€™s it. Go test Pipenv and tell me what you think !</p>\n<p>Cheers</p>\n","tags":[{"title":"Python","path":"/blog/tag/Python"},{"title":"Pip","path":"/blog/tag/Pip"},{"title":"Pipenv","path":"/blog/tag/Pipenv"},{"title":"Packages Management","path":"/blog/tag/Packages%20Management"}]}},"context":{}}