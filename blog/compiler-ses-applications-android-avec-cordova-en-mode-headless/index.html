<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="lang">
  <head>
    <title data-vue-tag="true">Compiler ses applications Android avec Cordova en mode headless - Julien Tanay</title><meta data-vue-tag="true" charset="utf-8"/><meta data-vue-tag="true" name="generator" content="Gridsome v0.5.4"/><meta data-vue-tag="true" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/><meta data-vue-tag="true" data-key="description" name="description" content="About Software Development, DevOps culture, creative thinking and hacking things."/><meta data-vue-tag="true" data-key="format-detection" name="format-detection" content="telephone=no"/><meta data-vue-tag="true" name="description" content="Retour d&#x27;expérience sur l&#x27;installation du SDK Android sur une Debian 64bits fraîchement installée."/><link data-vue-tag="true" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.9bb7ffa.png"/><link data-vue-tag="true" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.9bb7ffa.png"/><link data-vue-tag="true" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.9bb7ffa.png"/><link data-vue-tag="true" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.9bb7ffa.png"/><link data-vue-tag="true" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.9bb7ffa.png"/><link data-vue-tag="true" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.9bb7ffa.png"/><link data-vue-tag="true" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.9bb7ffa.png"/><link data-vue-tag="true" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.9bb7ffa.png"/><noscript data-vue-tag="true" ><style>.g-image--loading{display:none;}</style></noscript><link rel="preload" href="/assets/css/styles.994dae9e.css" as="style"><link rel="preload" href="/assets/js/app.971b028e.js" as="script"><link rel="preload" href="/assets/css/3.styles.399fc422.css" as="style"><link rel="preload" href="/assets/js/component--post.3bb65112.js" as="script"><link rel="prefetch" href="/assets/js/component--404.b1620c5f.js"><link rel="prefetch" href="/assets/js/component--home.31d8346b.js"><link rel="prefetch" href="/assets/js/component--tag.e0385307.js"><link rel="prefetch" href="/assets/js/page-query.1fa13168.js"><link rel="stylesheet" href="/assets/css/styles.994dae9e.css"><link rel="stylesheet" href="/assets/css/3.styles.399fc422.css">
  </head>
  <body data-vue-tag="">
    <script>
      // Add dark / light detection that runs before Vue.js load. Borrowed from overreacted.io
      (function() {
        window.__onThemeChange = function() {};
        function setTheme(newTheme) {
          window.__theme = newTheme;
          preferredTheme = newTheme;
          document.body.setAttribute('data-theme', newTheme);
          window.__onThemeChange(newTheme);
        }

        var preferredTheme;
        try {
          preferredTheme = localStorage.getItem('theme');
        } catch (err) { }

        window.__setPreferredTheme = function(newTheme) {
          setTheme(newTheme);
          try {
            localStorage.setItem('theme', newTheme);
          } catch (err) {}
        }

        var darkQuery = window.matchMedia('(prefers-color-scheme: dark)');
        darkQuery.addListener(function(e) {
          window.__setPreferredTheme(e.matches ? 'dark' : 'light')
        });

        setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'));
      })();
    </script>

    <div id="app" data-server-rendered="true"><header class="header"><div class="header__left"><a href="/" class="logo active"><span class="logo__text">
    ← Julien Tanay
  </span></a></div><div class="header__right"><button role="button" aria-label="Toggle dark/light" class="toggle-theme"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></button></div></header><main class="main"><div class="post-title"><h1 class="post-title__text">
      Compiler ses applications Android avec Cordova en mode headless
    </h1><div class="post-meta">
   Posted 16. July 2015.
   <strong>4 min read.</strong></div></div><div class="post content-box"><div class="post__header"><!----></div><div class="post__content"><p>On trouve ça et là des tutoriaux pour installer le SDK Android et compiler ses applications avec Cordova.</p>
<p>La plupart se contentent d’enchaîner les captures d'écrans en mode cliquodrome... Lorsqu'il s'agit d'équiper une machine sans interface graphique, idéalement pour en faire une machine de build, c'est tout de suite plus obscur. Vous êtes derrière un proxy ? Accrochez-vous.
Retour d'expérience sur l'installation du SDK Android sur une Debian 64bits fraîchement installée.</p>
<h2 id="rapatrier-les-dépendances"><a href="#rapatrier-les-d%C3%A9pendances" aria-hidden="true"><span class="icon icon-link"></span></a>Rapatrier les dépendances</h2>
<p>Installer <code class="language-text">wget</code> (si besoin), <code class="language-text">java7</code> et <code class="language-text">zipalign</code> qui nous servira à signer nos APK.</p>
<pre class="language-bash"><span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">wget</span> zipalign openjdk-7-jdk ant</pre>
<p>Sur une distribution 64bits récente, il vous faudra installer les dépendances suivantes :</p>
<p>Pour Ubuntu :</p>
<pre class="language-bash"><span class="token function">apt-get</span> <span class="token function">install</span> libc6-i386 libglib2.0-0:i386 libsm6:i386 libglu1-mesa:i386 libgl1-mesa-glx:i386 libxext6:i386 libxrender1:i386 libx11-6:i386 libfontconfig1:i386 lsb-core</pre>
<p>Pour Debian (testé sur Wheezy) :</p>
<pre class="language-bash">dpkg --add-architecture i386
<span class="token function">apt-get</span> update
<span class="token function">apt-get</span> <span class="token function">install</span> libncurses5:i386 libstdc++6:i386 zlib1g:i386</pre>
<h2 id="android-sdk-tool"><a href="#android-sdk-tool" aria-hidden="true"><span class="icon icon-link"></span></a>Android SDK Tool</h2>
<p>Sortez un terminal et récupérez la dernière version du SDK Tool (voir <a href="https://developer.android.com/sdk/index.html#Other" target="_blank" rel="nofollow noopener noreferrer">https://developer.android.com/sdk/index.html#Other</a>) :</p>
<pre class="language-bash"><span class="token function">cd</span> /tmp
<span class="token function">wget</span> http://dl.google.com/android/android-sdk_r24.3.3-linux.tgz
<span class="token function">tar</span> -xzf android-sdk_r24.3.3-linux.tgz
<span class="token function">rm</span> android-sdk_r24.3.3-linux.tgz
<span class="token function">mv</span> android-sdk-linux /opt/</pre>
<p>On a au passage extrait tout le dossier dans <code class="language-text">/opt</code> histoire d'y accéder facilement plus tard.</p>
<p>(Optionnel) Indiquer un proxy HTTP dans le fichier <code class="language-text">~/.android/androidtool.cfg</code> (pensez à remplacer les variables par de vraies valeurs) :</p>
<pre class="language-bash"><span class="token keyword">echo</span> <span class="token string">"sdkman.force.http=true
http.proxyHost=&lt;proxy_host>
http.proxyPort=&lt;proxy_port>"</span> <span class="token operator">></span> ~/.android/androidtool.cfg</pre>
<p>Une fois android-sdk-tools installé, rendez-le accessible dans votre PATH:</p>
<pre class="language-bash"><span class="token function">export</span> ANDROID_HOME<span class="token operator">=</span>/opt/android-sdk-linux
<span class="token function">export</span> PATH<span class="token operator">=</span><span class="token variable">${PATH}</span><span class="token keyword">:</span><span class="token variable">$ANDROID_HOME</span>/tools:<span class="token variable">$ANDROID_HOME</span>/platform-tools</pre>
<p>On récupère les dernières versions du SDK :</p>
<pre class="language-bash">android update sdk --no-ui</pre>
<p>(Optionnel) Installer une version des build-tools particulière :</p>
<pre class="language-bash">android update sdk --all --filter <span class="token string">"build-tools-22.0.1"</span> --no-ui</pre>
<p>That's it ! La machine est prête à enchaîner les builds. Essayez donc de créer un projet :</p>
<pre class="language-bash">android create project \
--target 1 \
--name MyAndroidApp \
--path ./MyAndroidAppProject \
--activity MyAndroidAppActivity \
--package com.example.myandroidapp</pre>
<p>On peut facilement ranger tout ça dans un script d'installation à soumettre à SaltSack ou Puppet. Reste à déclarer la machine, par exemple, en tant que slave Jenkins dédié à des jobs de compilation Android.</p>
<h2 id="cordova"><a href="#cordova" aria-hidden="true"><span class="icon icon-link"></span></a>Cordova</h2>
<p>Assurez-vous d'avoir la dernière version de NodeJS / NPM avant de passer à l'installation de Cordova (<a href="https://nodesource.com/blog/nodejs-v012-iojs-and-the-nodesource-linux-repositories" target="_blank" rel="nofollow noopener noreferrer">https://nodesource.com/blog/nodejs-v012-iojs-and-the-nodesource-linux-repositories</a>). C'est parti :</p>
<pre class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> -g cordova</pre>
<p>Note : Cordova utilise Gradle pour build les projets; le coup du proxy peut-être assez casse-tête.</p>
<p>(Optionnel) Indiquer un proxy HTTP et HTTPS dans le fichier <code class="language-text">~/.gradle/gradle.properties</code> (pensez à remplacer les variables par de vraies valeurs) :</p>
<pre class="language-text">echo &quot; systemProp.http.proxyHost=&lt;proxy_host&gt;
systemProp.http.proxyPort=&lt;proxy_port&gt;
systemProp.http.proxyUser=&lt;proxy_user&gt;
systemProp.http.proxyPassword=&lt;proxy_password&gt;
systemProp.https.proxyHost=&lt;proxy_host&gt;
systemProp.https.proxyPort=&lt;proxy_port&gt;
systemProp.https.proxyUser=&lt;proxy_user&gt;
systemProp.https.proxyPassword=&lt;proxy_password&gt; &quot; &gt; ~/.gradle/gradle.properties</pre>
<p>Placez-vous dans votre dossier de projet Cordova (ou créez-en un avec <code class="language-text">cordova create MonProjet</code>). Le petit bout de code suivant assure le build complet d'un APK signé. Il utilise 3 variables d'environnement pour récupérer l'emplacement de votre keystore (<code class="language-text">ANDROID_KEYSTORE</code>), le mot de passe associé (<code class="language-text">ANDROID_STORE_PASS</code>) et la keypass spécifique à votre application (<code class="language-text">ANDROID_KEY_PASS</code>). L’avantage direct de ces variables est de ne pas avoir à stocker dans le projet (et donc souvent dans un dépôt de versionning) des informations sensibles comme les passwords ou encore le fichier <code class="language-text">.keystore</code>. En plus, rien de plus facile pour Jenkins ou un autre outil d'intégration continue de passer ces variables avant le lancement d'un job de compilation.</p>
<pre class="language-bash">cordova platforms add android
cordova build android --release
jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore <span class="token variable"><span class="token variable">$(</span>ANDROID_KEYSTORE<span class="token variable">)</span></span> -storepass <span class="token variable"><span class="token variable">$(</span>ANDROID_STORE_PASS<span class="token variable">)</span></span> platforms/android/build/outputs/apk/android-release-unsigned.apk BatStat -keypass <span class="token variable"><span class="token variable">$(</span>ANDROID_KEY_PASS<span class="token variable">)</span></span>
zipalign -f -v 4 platforms/android/build/outputs/apk/android-release-unsigned.apk platforms/android/build/outputs/apk/android-release-signed.apk</pre>
<p>Vous pouvez à loisir mettre ça dans une target <code class="language-text">android</code> d'un fichier <code class="language-text">Makefile</code> et lancer un joli <code class="language-text">make android</code> pour compiler vos applis ! Joie !</p>
<p>N'hésitez pas à laisser vos commentaires juste là-dessous.</p>
<h2 id="quelques-liens"><a href="#quelques-liens" aria-hidden="true"><span class="icon icon-link"></span></a>Quelques liens</h2>
<ul>
<li><a href="https://developer.android.com/sdk/index.html" target="_blank" rel="nofollow noopener noreferrer">https://developer.android.com/sdk/index.html</a></li>
<li><a href="https://developer.android.com/tools/projects/projects-cmdline.html" target="_blank" rel="nofollow noopener noreferrer">https://developer.android.com/tools/projects/projects-cmdline.html</a></li>
<li><a href="http://doc.ubuntu-fr.org/android_sdk" target="_blank" rel="nofollow noopener noreferrer">http://doc.ubuntu-fr.org/android_sdk</a></li>
<li><a href="https://cordova.apache.org/" target="_blank" rel="nofollow noopener noreferrer">https://cordova.apache.org/</a></li>
</ul>
</div><div class="post__footer"><div class="post-tags"><a href="/blog/tag/integration-continue" class="post-tags__link"><span>#</span> Intégration Continue
		</a><a href="/blog/tag/android" class="post-tags__link"><span>#</span> Android
		</a><a href="/blog/tag/sdk" class="post-tags__link"><span>#</span> SDK
		</a><a href="/blog/tag/cordova" class="post-tags__link"><span>#</span> Cordova
		</a><a href="/blog/tag/jenkins" class="post-tags__link"><span>#</span> Jenkins
		</a><a href="/blog/tag/headless" class="post-tags__link"><span>#</span> headless
		</a></div></div></div><div class="post-comments"></div><div class="author post-author"><img alt="Author image" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 180 180' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-13'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='5'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-13)' width='180' height='180' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCABAAEADASIAAhEBAxEB/8QAGwAAAgMBAQEAAAAAAAAAAAAABgcEBQgCAwH/xAAyEAABAwIFAgQFAgcAAAAAAAABAgMEBREABhIhMRNBByJRYRQycYGRI7EIFjNyosHw/8QAGQEAAgMBAAAAAAAAAAAAAAAABAUAAgMB/8QAKhEAAQQABQIFBQEAAAAAAAAAAQACAxEEEiExQSJRBROBkaFhcbHh8MH/2gAMAwEAAhEDEQA/AMqY%2b98fMdtIU46hCfmUQkffEURVSMvQn4DL06UtrWA4rQLnTc7D3wYUSsUujlqPRIKGkDzqlOHW8r032Axe0nLMWr1CLR2kKWQ1pbWkWCEoFiSRxv373wRnwVDVPdWkSlyEnULCw04RS4hsxLX3Xbj4TyLDhgBAFoKzbmukZkhNMRoYMptJKnFAWWb/APb4V9SpZbdOhOgqOySoEH6YbNY8OlxktuxSUnm3II9/fAfWMsVPWolTbixxcW2xrhJIYumN2n1VMRA54twQ3R6izSolViy6UxKelNdJDjw80dW41J2O%2b/txisZjqcIAF74v3Irklm7qAmWwsMvN6eRbyqPv2/GGD4RZPg1mvxUTnEtNKNla%2bMET4pmHY6QpfDgwHucOd9%2bBX9SS6UlSrAEn0GJLCEtPNrd3CVAlKTcnvbEpSFLN0sOaVKJPTT9%2bRiXTYfxMtiM3Hd6rzqWkak2F1GwufTBbpKCq2KytS%2bBsFkpqVRCCtxelANr6RzYYbcoyFMABwtpO23OMeZ0y/m6msSZMJ9xESBITFSYDy7vEt6ysWsdICe%2b/PvjqmtVWrZbTUMt5wri6jZCREfmKB6qUEuNjfcmxWi22lJ1EKsCthwmdpLXbo6XFBj6c1aTrWXy6SI%2bh5CxqUm4SQSeR%2beMLqvU5uOtTLybKB%2b4wl6TmPxFeok%2btQ6tVnIEVaEvPqUVp1bEC5vvwcS8pVzM2aXn0fzDFalNKSpTciPqUprfW4NKSVaTp8ouo6rgEA2zPhhLraQtR4g0DqB1VnXoaIlZdW0Bpkxil0ab3KVJKT7H3xDps56MW1Mkt2vxiqhVGst5zap%2bY0oaU04WpJ0A6Uk7kKTcEbCxFx6YN24lBcdQlqptrUFKGlAJJNuLWwPigYSGSC9ONV2N7Zbcw0rhb0SixoUanuQ5B%2bCEjppuQiw%2bUqB542O%2bIlLz6uyDIpcRSbjzJWRbcfnFtVaEIlSIpojpQSQoIbHH2HGPeLl6c8hYbj08FKdYQWkXI9RcXwFiIYR1SAX3uuT%2bvZaBr4%2bkusjnQfhMGGxFep05uPNE34l5E1uUEjZRBCTY3BAA0kdwSMDdSo9Oef6QyflyXL%2bS5haLH%2b1N/3GPPJIdgVF2LLDKOqglGhICbp5G31wV13M7tMqLEDLsVL0x79V9ex3Pa52Fhvvxg%2bDzZKERrn0GvJC3ZGJTWWz7fdUr87LEPw6qWXorgcWoKafKGShJetupN%2bQDYC1xZIHbCgi5ZjMqRUBC6M8KKjIiS1sqC%2b6hb5b78Yt85w5khx%2bS%2b06ib1OoHo0lDgT33R3xVUisuOwnIssWltH5kgjqJPG3Y3wSHnJmaTmv0r3u7%2bF18MLW04a%2bhCNfC6k0xLlRm16PNk06NHait2Zcl6OmdQBXbZKU7AbAA2HGDlyiZQrtCqE7L8IM/DoUoSGkqZKVadW3FwR7WwYUfJU%2bmZMRBplckQkuRipxpUZtf6i03XckXvc/bCeosCfFiPJFeqCWXWQVsEIKT5LaeL%2b2FvjuB6GysdT9Nbd9OAa%2bEshlEjiG6AKylTJyH0KCGEKWFIWPKLgFPYfvia05/UdqK1al%2bc3BFz9bYuqJ4c1apPsSK8Y8NKdV0JeLqzf6WA/JwdMZUpMXppeY662hsp0k/TbjFnQSSRnNdhXdO3NolJm2iSGvD5FYhEplxH1ygbG62jYEfSwvhbZXzehNYfnVVSiy4DrQFbkcAD2xqSrpS60WSkFChpII2IxkzOWR%2bnV5yaY6thLbiwlpwbWv2PpgrDxDyjnGgqz2v9oqOOR7C9g2XpmBykOvyqjBfdjqSrUUKWCkj27468GKXPzr4mxW0JD1PhEPynEWFm0q2G/qqw/OAN3LNUKunJdbQjudWrb2GNEfwwx00Ck1pcH4JTrrzba3JTxQo2STtZJ282GLPIAaBv3/tuyHxT5CwU3LW%2bu5/xaOu4qOoOIsog3sRjOdcp9IiZejS136tkkyUsgr43Ukc3Ha%2bHO5mGYkLu5RwRwOu4b/4YEqpUHpDam1RsqlJFrLjrV/rC/xcNmaynVlN/f5QmEzMcTW6/9k=' /%3e%3c/svg%3e" width="180" data-src="/assets/static/author.e6b6009.1ecea5f.jpg" data-srcset="/assets/static/author.e6b6009.1ecea5f.jpg 180w" data-sizes="(max-width: 180px) 100vw, 180px" class="author__image g-image g-image--lazy g-image--loading"><noscript><img src="/assets/static/author.e6b6009.1ecea5f.jpg" class="author__image g-image g-image--loaded" width="180"></noscript><!----><p class="author__intro">
    About Software Development, DevOps culture, creative thinking and hacking things.
  </p><p class="author__links"><a href="//twitter.com/djiit">Follow on Twitter</a><a href="//github.com/djiit">GitHub</a></p></div></main><footer class="footer"><span class="footer__copyright">Copyright © 2015 - 2019.
    </span><span class="footer__links">Powered by <a href="//gridsome.org"> Gridsome </a></span></footer></div>
    <script src="/assets/js/app.971b028e.js" defer></script><script src="/assets/js/component--post.3bb65112.js" defer></script>
  </body>
</html>